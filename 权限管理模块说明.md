# 权限管理模块数据初始化说明

## 📋 已创建的数据库表

### 权限管理表
1. **user** - 用户表（系统用户和客户用户统一管理）
2. **role** - 角色表
3. **user_role** - 用户角色关联表
4. **resource** - 资源表（平台、目录、菜单、按钮权限）
5. **role_resource** - 角色资源关联表
6. **dept** - 部门表（支持层级结构）
7. **post** - 岗位表

### 业务功能表
8. **reservation** - 预约表（支持参观预约和探访预约）
9. **nursing_project_plan** - 护理项目计划关联表

## 🔧 执行步骤

### 1. 执行SQL文件（如果还没执行）
```sql
-- 创建表结构
-- 执行: D:\zzyl_Demo\zzyl\sql\security_and_reservation_tables.sql
```

### 2. 初始化基础数据
```sql
-- 插入基础数据
-- 执行: D:\zzyl_Demo\zzyl\sql\security_initial_data.sql
```

### 3. 检查表是否创建成功
```sql
-- 执行: D:\zzyl_Demo\zzyl\sql\check_new_tables.sql
```

## 👤 默认账户信息

### 系统管理员
- **用户名**: admin
- **密码**: 123456
- **用户类型**: 系统用户
- **角色**: 超级管理员
- **权限**: 全部系统权限

### 默认部门结构
```
中州养老集团 (root)
├── 人力资源部 (hr)
├── 护理部 (nursing)
├── 行政部 (admin)
├── 财务部 (finance)
└── 医务部 (medical)
```

### 默认岗位
每个部门都有对应的岗位，如：
- 人力资源部: HR经理、HR专员
- 护理部: 护理主管、护理组长、护理员
- 行政部: 行政主管、行政专员
- 财务部: 财务主管、会计
- 医务部: 医务主管、医生、护士

## 🎯 权限体系说明

### 资源类型
- **s**: 平台级别
- **c**: 目录
- **m**: 菜单
- **r**: 按钮（操作权限）

### 数据范围（角色）
- **0**: 自定义
- **1**: 本人
- **2**: 本部门及以下
- **3**: 本部门
- **4**: 全部

### 用户类型
- **0**: 系统用户（后台管理人员）
- **1**: 客户用户（小程序用户）

## 📱 与小程序的集成

### 微信用户同步
当微信小程序用户登录时，会自动创建用户类型为"1"的客户用户记录：

```sql
INSERT INTO user (open_id, nick_name, avatar, mobile, user_type, data_state)
VALUES ('微信openId', '昵称', '头像URL', '手机号', '1', '0');
```

### 预约功能增强
新增的预约表支持：
- 探访预约（type=1）：需要指定探访的老人（elder_id）
- 参观预约（type=0）：普通参观预约
- 预约状态管理：待报道、已完成、取消、过期

## 🔄 下一步开发建议

1. **Mapper接口创建**: 为每个实体创建MyBatis Mapper接口
2. **XML映射文件**: 创建对应的SQL映射文件
3. **Service实现**: 实现Service接口的具体业务逻辑
4. **Controller层**: 创建REST API接口
5. **权限拦截器**: 实现基于角色的权限控制
6. **前端页面**: 在管理后台添加权限管理页面

## 📞 技术支持

如果遇到问题，请检查：
1. 数据库连接是否正常
2. SQL文件是否完全执行
3. 用户密码是否正确加密（默认使用BCrypt加密）
4. 表结构是否符合预期